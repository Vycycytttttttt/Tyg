<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لعبة Flappy Bird بتغييرات الطقس</title>
  <style>
    /* إعداد الخلفية العامة */
    body {
      margin: 0;
      overflow: hidden;
      background: #70c5ce;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #70c5ce;
    }
    /* تأثيرات الشمس مع إشعاع واقعي */
    .sun {
      position: absolute;
      top: 50px;
      left: 50px;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffdd00 0%, #ff9900 70%);
      box-shadow: 0 0 20px 10px rgba(255, 221, 0, 0.5);
      z-index: 10;
    }
    /* إعدادات السحب */
    .cloud {
      position: absolute;
      background: #fff;
      border-radius: 50%;
      opacity: 0.8;
      z-index: 8;
    }
    /* تأثيرات الأمطار */
    .rain {
      position: absolute;
      width: 2px;
      height: 10px;
      background: #0cf;
      animation: fall 0.5s linear infinite;
      z-index: 9;
    }
    @keyframes fall {
      0% { transform: translateY(0); }
      100% { transform: translateY(100px); }
    }
    /* تأثيرات الثلوج */
    .snow {
      position: absolute;
      width: 5px;
      height: 5px;
      background: #fff;
      border-radius: 50%;
      opacity: 0.9;
      animation: fallSnow 3s linear infinite;
      z-index: 9;
    }
    @keyframes fallSnow {
      0% { transform: translateY(0); }
      100% { transform: translateY(100px); }
    }
    /* تأثيرات الرعد */
    .thunder {
      position: absolute;
      width: 5px;
      height: 100px;
      background: yellow;
      animation: flash 0.2s ease-in-out infinite;
      z-index: 11;
    }
    @keyframes flash {
      0% { opacity: 1; }
      50% { opacity: 0.1; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- عنصر الشمس -->
  <div id="sun" class="sun"></div>
  <!-- الحاويات للتأثيرات -->
  <div id="clouds-container"></div>
  <div id="rain-container"></div>
  <div id="snow-container"></div>
  <div id="thunder-container"></div>
  
  <canvas id="gameCanvas"></canvas>
  <script>
    /***********************
     * إعدادات اللعبة الأساسية
     ***********************/
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let level = 0;
    let score = 0;
    let gameSpeed = 2; // سرعة اللعبة الأساسية

    /***********************
     * متغيرات وتحكم الطقس
     ***********************/
    let currentWeather = "clear";
    let weatherTransitionTimeout;

    // دالة تحديث حالة الطقس مع تأخير الانتقال لمدة 3 ثوانٍ
    function updateWeather() {
      clearTimeout(weatherTransitionTimeout);
      weatherTransitionTimeout = setTimeout(() => {
        if (level >= 300) {
          currentWeather = "difficult";
          setWeather("snow");
          gameSpeed = 4; // زيادة سرعة اللعبة بشكل أكبر
        } else if (level >= 130) {
          currentWeather = "challenging";
          gameSpeed = 3; // زيادة بسيطة بالسرعة
          setWeather("rainThunder");
        } else if (level >= 90) {
          currentWeather = "winter";
          setWeather("snow");
        } else if (level >= 70) {
          currentWeather = "cloudy";
          setWeather("clouds");
        } else if (level >= 50) {
          currentWeather = "rainThunder";
          setWeather("rainThunder");
        } else {
          currentWeather = "clear";
          clearWeather();
          gameSpeed = 2;
        }
      }, 3000);
    }

    // دالة تطبيق تأثيرات الطقس بناءً على النوع
    function setWeather(type) {
      clearWeather(); // تنظيف التأثيرات الحالية
      if (type === "rainThunder") {
        // إضافة الأمطار
        let rainContainer = document.getElementById("rain-container");
        for (let i = 0; i < 50; i++) {
          let drop = document.createElement("div");
          drop.className = "rain";
          drop.style.left = Math.random() * window.innerWidth + "px";
          drop.style.top = Math.random() * window.innerHeight + "px";
          rainContainer.appendChild(drop);
        }
        // إضافة الرعد عشوائياً (اثنين من الصواعق)
        let thunderContainer = document.getElementById("thunder-container");
        for (let i = 0; i < 2; i++) {
          let bolt = document.createElement("div");
          bolt.className = "thunder";
          bolt.style.left = Math.random() * window.innerWidth + "px";
          bolt.style.top = Math.random() * (window.innerHeight / 2) + "px";
          thunderContainer.appendChild(bolt);
        }
        // تظهر الشمس مع تأثير إشعاعها
        document.getElementById("sun").style.display = "block";
      } else if (type === "clouds") {
        // إزالة الشمس لجعل الجو غائم
        document.getElementById("sun").style.display = "none";
        let cloudsContainer = document.getElementById("clouds-container");
        for (let i = 0; i < 5; i++) {
          let cloud = document.createElement("div");
          cloud.className = "cloud";
          cloud.style.width = (100 + Math.random() * 100) + "px";
          cloud.style.height = (50 + Math.random() * 30) + "px";
          cloud.style.left = Math.random() * window.innerWidth + "px";
          cloud.style.top = Math.random() * (window.innerHeight / 2) + "px";
          cloudsContainer.appendChild(cloud);
        }
      } else if (type === "snow") {
        // إضافة تأثير الثلوج
        let snowContainer = document.getElementById("snow-container");
        for (let i = 0; i < 50; i++) {
          let snowflake = document.createElement("div");
          snowflake.className = "snow";
          snowflake.style.left = Math.random() * window.innerWidth + "px";
          snowflake.style.top = Math.random() * window.innerHeight + "px";
          snowContainer.appendChild(snowflake);
        }
        // يتم عرض الشمس مع الثلوج لخلق جو شتوي إذا رغبت بذلك
        document.getElementById("sun").style.display = "block";
      }
    }

    // دالة مسح التأثيرات الحالية
    function clearWeather() {
      document.getElementById("rain-container").innerHTML = "";
      document.getElementById("thunder-container").innerHTML = "";
      document.getElementById("clouds-container").innerHTML = "";
      document.getElementById("snow-container").innerHTML = "";
      // عرض الشمس بشكل افتراضي إذا لم يكن هناك غيوم
      document.getElementById("sun").style.display = "block";
    }

    /***********************
     * دوال اللعبة الأساسية
     ***********************/
    // تحديث منطق اللعبة
    function updateGame() {
      score++;
      // رفع المستوى كلما زادت النقاط (مثلاً كل 100 نقطة)
      if (score % 100 === 0) {
        level++;
        updateWeather();
      }
      // يمكن تعديل منطق العقبات أو سرعة الحركة بناءً على gameSpeed
      // مثال: زيادة سرعة حركة العقبات مع ارتفاع مستوى التحدي
      // (يفترض أن الكود الأصلي يحتوي على هذا النوع من المنطق)
    }

    // رسم مكونات اللعبة (مثل الخلفية، النص، اللاعب والعقبات)
    function drawGame() {
      // تنظيف القماش
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // رسم الخلفية
      ctx.fillStyle = "#70c5ce";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      // عرض النصوص الخاصة بالنقاط والمستوى
      ctx.fillStyle = "#fff";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 20, 30);
      ctx.fillText("Level: " + level, 20, 60);
      // هنا يتم رسم اللاعب والعقبات حسب الكود الأصلي
    }

    // حلقة التشغيل الرئيسية
    function gameLoop() {
      updateGame();
      drawGame();
      requestAnimationFrame(gameLoop);
    }

    // بدء اللعبة
    gameLoop();
  </script>
</body>
</html>